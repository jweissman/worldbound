{"version":3,"sources":["types/Palette.ts","util/assertNever.ts","Nav.ts","actors/WorldView.ts","scenes/Life.ts","Game.ts","models/Stack.ts","util/distance.ts","util/flip.ts","util/iota.ts","util/pick.ts","util/count.ts","models/Conway.ts","util/matrix.ts","models/Grid.ts","models/World/WorldConfig.ts","models/World/WorldSize.ts","models/World/Evolution.ts","models/World/index.ts","index.ts"],"names":["scale","dark","lo","mid","hi","toTriple","c","r","g","b","x","Error","assertNever","colorMap","rgb","concat","join","Pan","WorldView","world","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","sz","lastFilled","_onScreenXStart","_onScreenXEnd","_onScreenYStart","_onScreenYEnd","ctx","y","color","fillStyle","fillRect","delta","_this2","emit","Events","PreDrawEvent","clouds","layers","rows","m","cols","n","xEnd","Math","min","yEnd","entries","forEach","_ref","_ref2","slicedToArray","grid","config","visible","translucent","globalAlpha","i","j","x0","y0","at","engine","worldCoordsUpperLeft","screenToWorldCoordinates","Vector","worldCoordsLowerRight","canvas","clientWidth","clientHeight","cellWidth","cellHeight","pos","max","floor","Actor","NavController","game","camera","dragging","dragOrigin","pointerMoveCallback","leftClickCallback","cameraPanCallback","keyPressCallback","moveCam","direction","camMoveSpeed","getZoom","dv","Left","Right","Up","Down","move","add","createClass","key","value","cb","input","pointers","primary","on","e","sub","coordinates","worldPos","coordiantes","target","button","Input","PointerButton","console","log","window","addEventListener","z","deltaY","zoom","capture","passive","keyboard","Keys","W","A","S","D","off","Life","_Scene","worldView","nav","inherits","activate","deactivate","Scene","Game","_Engine","backgroundColor","Color","Black","pageScrollPreventionMode","ScrollPreventionMode","None","addScene","assertThisInitialized","goToScene","evolve","Engine","Stack","distance","x1","x2","y1","y2","abs","flip","a","weight","arguments","length","undefined","random","indexSpaces","iota","nums","push","pick","_len","list","Array","_key","count","property","reduce","acc","curr","simpleConway","birth","lonely","starve","cell","neighbors","active","ns","Boolean","conway","eachMatrixCoordinate","fn","GridStructure","elements","BitArray","elems","reset","elem","idx","set","get","addr","toggle","Grid","initFn","structure","loc","put","dims","location","withinBounds","_this3","newStructure","_this4","dx","dy","empty","radius","community","neighborCells","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","val","err","return","books","judgment","gatherNeighbors","death","life","_this5","cellCallback","judgeCell","fz","eps","gol","_location","ratio","neighborsMap","communityMap","defaultConfig","size","waterRatio","cloudRatio","tickSeries","map","t","pow","dimensions","tiny","unit","small","medium","large","huge","gigantic","enormous","PlanetaryEvolution","smooth","water","apply","toConsumableArray","grass","trees","ocean","veg","sky","waterNeighbors","trail","path","animals","movers","stepCandidates","step","filter","s","sort","find","windPushesClouds","shift","Person","World","player","stack","ticks","evolutionarySeries","animalsWander","cloudsGather","treesGrow","cloudsForm","grassGrows","trailsDecay","assemble","humans","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","oceanLevelsRise","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","evolved","prepareLandscape","evolution","index","interval","start"],"mappings":"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","file":"static/js/main.bc615219.chunk.js","sourcesContent":["import { assertNever } from \"../util/assertNever\";\r\nconst primaryColors = [\r\n    'red', 'blue', 'green', 'black', 'white'\r\n] as const;\r\nconst secondaryColors = ['brown', 'light-brown', 'dark-green', 'pink'] as const;\r\ntype Primary = typeof primaryColors[number];\r\ntype Secondary = typeof secondaryColors[number];\r\n\r\nexport type Color = Primary | Secondary\r\n\r\nlet scale = { dark: 40, lo: 80, mid: 160, hi: 240}\r\nfunction toTriple(c: Color): number[] {\r\n    let { hi, mid, lo, dark } = scale;\r\n    let r = lo, g = lo, b = lo;\r\n    switch (c) {\r\n        case 'white': r = hi; g = hi; b = hi; break;\r\n        case 'black': r = dark; g = dark; b = dark; break;\r\n        case 'blue': b = hi; break;\r\n        case 'red': r = hi; break;\r\n        case 'pink': r = hi; g= mid; b = mid; break;\r\n        case 'green': g = hi; break;\r\n        case 'brown': r = mid; g = lo; b= dark; break;\r\n        case 'light-brown': r = hi; g = mid; b = lo; break;\r\n        case 'dark-green': r = dark; g = mid; b = dark; break;\r\n        default: assertNever(c)\r\n    }\r\n\r\n    return [r,g,b]; //\r\n}\r\nlet colorMap: { [key: string]: string } = {}\r\nexport function rgb(c: Color): string {\r\n    if (!colorMap[c]) { //return colorMap[c]; }\r\n        colorMap[c] = `rgb(${toTriple(c).join(',')})`\r\n    }\r\n    return colorMap[c];\r\n}\r\n","export function assertNever(x: never): never {\r\n    throw new Error(\"Unexpected object: \" + x);\r\n}\r\n","import {\r\n    Vector,\r\n    Input,\r\n    Engine,\r\n    Camera,\r\n} from \"excalibur\";\r\n\r\nenum Pan { Up, Down, Left, Right }\r\nexport class NavController {\r\n\r\n    private dragging: boolean = false\r\n    private dragOrigin?: Vector\r\n\r\n    private pointerMoveCallback?: (pos: Vector) => any\r\n    private leftClickCallback?: (pos: Vector, holdingShift: boolean) => any\r\n    private cameraPanCallback?: () => any\r\n    private keyPressCallback?: (key: any) => any\r\n\r\n    constructor(private game: Engine, private camera: Camera) {\r\n        \r\n    }\r\n\r\n    onMove(cb: (pos: Vector) => any) {\r\n        this.pointerMoveCallback = cb\r\n    }\r\n\r\n    onLeftClick(cb: (pos: Vector, holdingShift: boolean) => any) {\r\n        this.leftClickCallback = cb\r\n    }\r\n\r\n    onCameraPan(cb: () => any) {\r\n        this.cameraPanCallback = cb\r\n    }\r\n\r\n    onKeyPress(cb: (key: any) => any) {\r\n        this.keyPressCallback = cb\r\n    }\r\n\r\n    moveCam = (direction: Pan) => {\r\n        if (this.cameraPanCallback) {\r\n            this.cameraPanCallback()\r\n        }\r\n        let camMoveSpeed = 10 * (1 / this.camera.getZoom())\r\n        let dv = new Vector(0, 0)\r\n        switch (direction) {\r\n            case Pan.Left: dv.x = -camMoveSpeed; break\r\n            case Pan.Right: dv.x = camMoveSpeed; break\r\n            case Pan.Up: dv.y = -camMoveSpeed; break\r\n            case Pan.Down: dv.y = camMoveSpeed; break\r\n        }\r\n        this.camera.move(this.camera.pos.add(dv), 0)\r\n    }\r\n\r\n\r\n    activate() {\r\n        this.game.input.pointers.primary.on('move', (e: any) => { //} Input.PointerMoveEvent) => {\r\n            if (this.dragging) {\r\n                if (this.dragOrigin) {\r\n                    this.camera.pos = this.camera.pos.add(\r\n                        this.dragOrigin.sub(e.coordinates.worldPos)\r\n                    )\r\n                }\r\n            } else {\r\n                if (this.pointerMoveCallback) {\r\n                    this.pointerMoveCallback(e.coordiantes.worldPos)\r\n                }\r\n\r\n            }\r\n        })\r\n\r\n        this.game.input.pointers.primary.on('up', () => {\r\n            if (this.dragging) { this.dragging = false; }\r\n        })\r\n\r\n        this.game.input.pointers.primary.on('down', (e: any) => { //} Input.PointerDownEvent) => {\r\n            if (e.target.button === Input.PointerButton.Left) {//} && this.leftClickCallback) {\r\n                // if (this.leftClickCallback) {\r\n                //     this.leftClickCallback(\r\n                //         e.coordinates.worldPos,\r\n                //         this.game.input.keyboard.isHeld(Input.Keys.Shift)\r\n                //     )\r\n                // } else {\r\n                    // this.moveCam()\r\n                    // this.pan\r\n                    this.camera.move(e.coordinates.worldPos, 250)\r\n                // }\r\n\r\n            } else { //if (e.target.button === Input.PointerButton.Middle ||\r\n                      // e.target.button === Input.PointerButton.Right) {\r\n                          \r\n                this.dragging = true;\r\n                this.dragOrigin = e.coordinates.worldPos //.target.pos\r\n                console.log(\"DRAG EM\", e)\r\n            }\r\n        })\r\n\r\n        window.addEventListener(\"wheel\", (e: WheelEvent) => {\r\n        // this.game.input.pointers.primary.on('wheel', (e: GameEvent<Input.WheelEvent>) => {\r\n            let z = this.camera.getZoom()\r\n            let step = 0.05\r\n            let min = 0.5, max = 2\r\n            if (e.deltaY < 0) { //}.target.deltaY < 0) {\r\n                this.camera.zoom(Math.min(z + step, max))\r\n            } else if (e.deltaY > 0) {\r\n                this.camera.zoom(Math.max(z - step, min))\r\n            }\r\n        // })\r\n            console.log('wheeee', e)\r\n        }, { capture: true, passive: false });\r\n\r\n\r\n        // let { Up, Down, Left, Right } = Orientation;\r\n\r\n        this.game.input.keyboard.on('press', (e: Input.KeyEvent) => {\r\n            if (e.key === Input.Keys.Up || e.key === Input.Keys.W) {\r\n                this.moveCam(Pan.Up)\r\n            } else if (e.key === Input.Keys.Left || e.key === Input.Keys.A) {\r\n                this.moveCam(Pan.Left)\r\n            } else if (e.key === Input.Keys.Down || e.key === Input.Keys.S) {\r\n                this.moveCam(Pan.Down)\r\n            } else if (e.key === Input.Keys.Right || e.key === Input.Keys.D) {\r\n                this.moveCam(Pan.Right)\r\n            } else {\r\n                if (this.keyPressCallback) {\r\n                    this.keyPressCallback(e.key)\r\n                }\r\n            }\r\n        })\r\n\r\n        this.game.input.keyboard.on('hold', (e: Input.KeyEvent) => {\r\n            if (e.key === Input.Keys.Up || e.key === Input.Keys.W) {\r\n                this.moveCam(Pan.Up)\r\n            } else if (e.key === Input.Keys.Left || e.key === Input.Keys.A) {\r\n                this.moveCam(Pan.Left)\r\n            } else if (e.key === Input.Keys.Down || e.key === Input.Keys.S) {\r\n                this.moveCam(Pan.Down)\r\n            } else if (e.key === Input.Keys.Right || e.key === Input.Keys.D) {\r\n                this.moveCam(Pan.Right)\r\n            }\r\n        })\r\n    }\r\n\r\n    deactivate(): any {\r\n        this.game.input.keyboard.off('press')\r\n        this.game.input.keyboard.off('hold')\r\n        // this.game.input.pointers.primary.off('wheel') //, (e: Input.WheelEvent) => {\r\n        this.game.input.pointers.primary.off('down') //, (e: Input.WheelEvent) => {\r\n        this.game.input.pointers.primary.off('up') //, (e: Input.WheelEvent) => {\r\n    }\r\n}","import { Actor, Events, Engine, Vector } from \"excalibur\";\r\nimport { World } from \"../models/World\";\r\nimport { Color, rgb } from \"../types/Palette\";\r\n\r\nclass WorldView extends Actor {\r\n    colorMap: Color[][] = [];\r\n    sz: number = 8\r\n    lastFilled: Color | null = null;\r\n\r\n    constructor(public world: World) {\r\n        super();\r\n    }\r\n\r\n    private drawCell(\r\n        ctx: CanvasRenderingContext2D,\r\n        x: number,\r\n        y: number,\r\n        color: Color,\r\n    ) {\r\n        if (color !== this.lastFilled) {\r\n            ctx.fillStyle = rgb(color);\r\n            this.lastFilled = color;\r\n        }\r\n        ctx.fillRect(x,y,this.sz,this.sz);\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        this.emit('predraw', new Events.PreDrawEvent(ctx, delta, this));\r\n        let clouds = this.world.layers['clouds'] //.m\r\n        // this.world.\r\n        // if (m.length) {\r\n            this.lastFilled = null;\r\n\r\n            let frame = 3;\r\n            let rows = clouds.m, cols = clouds.n;\r\n            let x = this._onScreenXStart;\r\n            const xEnd = Math.min(this._onScreenXEnd, clouds.m-frame); \r\n            let y = this._onScreenYStart;\r\n            const yEnd = Math.min(this._onScreenYEnd, clouds.n-frame); //Math.min(this._onScreenYEnd, rows);\r\n            ctx.fillStyle='#642'\r\n            ctx.fillRect(x, y, rows * this.sz, cols * this.sz)\r\n\r\n            Object.entries(this.world.layers).forEach(([_layer, grid]) => {\r\n                if (!grid.config.visible) { return }\r\n                if (grid.config.translucent) {\r\n                    ctx.globalAlpha = 0.6\r\n                }\r\n                let color = grid.config.color //colorFor(value)\r\n                if (color) {\r\n                    if (color !== this.lastFilled) {\r\n                        ctx.fillStyle = rgb(color);\r\n                        this.lastFilled = color;\r\n                    }\r\n                    for (let i = x; i < xEnd; i++) {\r\n                        for (let j = y; j < yEnd; j++) {\r\n                            let x0 = i, y0 = j;\r\n                            let value = grid.at({ x: x0, y: y0 })\r\n                            if (value) {\r\n                                ctx.fillRect(\r\n                                    x0 * this.sz,\r\n                                    y0 * this.sz,\r\n                                    this.sz, this.sz\r\n                                );\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (grid.config.translucent) {\r\n                    ctx.globalAlpha = 1.0\r\n                }\r\n            })\r\n        // }\r\n        this.emit('postdraw', new Events.PreDrawEvent(ctx, delta, this));\r\n    }\r\n\r\n    update(engine: Engine, delta: number) {\r\n\r\n        const worldCoordsUpperLeft = engine.screenToWorldCoordinates(new Vector(0, 0));\r\n        const worldCoordsLowerRight = engine.screenToWorldCoordinates(new Vector(engine.canvas.clientWidth, engine.canvas.clientHeight));\r\n\r\n        let cellWidth = this.sz, cellHeight = this.sz;\r\n        let x = this.pos.x, y = this.pos.y;\r\n        this._onScreenXStart = Math.max(Math.floor((worldCoordsUpperLeft.x - x) / cellWidth) - 2, 0);\r\n        this._onScreenYStart = Math.max(Math.floor((worldCoordsUpperLeft.y - y) / cellHeight) - 2, 0);\r\n        this._onScreenXEnd = Math.max(Math.floor((worldCoordsLowerRight.x - x) / cellWidth) + 2, 0);\r\n        this._onScreenYEnd = Math.max(Math.floor((worldCoordsLowerRight.y - y) / cellHeight) + 2, 0);\r\n\r\n    }\r\n    private _onScreenXStart: number = 0;\r\n    private _onScreenXEnd: number = 9999;\r\n    private _onScreenYStart: number = 0;\r\n    private _onScreenYEnd: number = 9999;\r\n}\r\n\r\nexport default WorldView;","import WorldView from \"../actors/WorldView\";\r\nimport { Scene } from \"excalibur\";\r\nimport { Game } from \"../Game\";\r\nimport { NavController } from \"../Nav\";\r\n\r\nexport class Life extends Scene {\r\n    private worldView: WorldView;\r\n    private nav: NavController;\r\n    constructor(private game: Game) {\r\n        super(game);\r\n        this.worldView = new WorldView(game.world);\r\n        this.nav = new NavController(game, this.camera)\r\n    }\r\n    onInitialize() {\r\n        this.add(this.worldView);\r\n    }\r\n    onActivate() {\r\n        this.nav.activate()\r\n    }\r\n    onDeactivate() {\r\n        this.nav.deactivate()\r\n    }\r\n}\r\n","import { Engine, ScrollPreventionMode, Color } from \"excalibur\";\r\nimport { Life } from \"./scenes/Life\";\r\nimport { World } from \"./models/World\";\r\n\r\nexport class Game extends Engine {\r\n    constructor(public world: World) {\r\n        super();\r\n        this.backgroundColor = Color.Black\r\n        this.pageScrollPreventionMode = ScrollPreventionMode.None; //.None;\r\n        this.addScene('life', new Life(this))\r\n        this.goToScene('life')\r\n\r\n        console.log(\"W O R L D     B O U N D\")\r\n        console.log(\"Are you ready???\")\r\n    }\r\n\r\n    onPreUpdate() {\r\n        this.world.evolve()\r\n    }\r\n}","import Grid from \"../models/Grid\";\r\n\r\nexport type StackLayers = {\r\n    water: Grid,\r\n    grass: Grid,\r\n    trees: Grid,\r\n    animals: Grid,\r\n    clouds: Grid,\r\n    trail: Grid,\r\n    path: Grid,\r\n    humans: Grid,\r\n}\r\n\r\nclass Stack {\r\n    constructor(public layers: StackLayers) {};\r\n}\r\n\r\nexport default Stack;","// const _euclid = (x1: number, x2: number, y1: number, y2: number): number => {\r\n//     let a = x1 - x2;\r\n//     let b = y1 - y2;\r\n//     let c = Math.sqrt(a*a + b*b);\r\n//     return c;\r\n// }\r\nconst manhattan = (x1: number, x2: number, y1: number, y2: number): number => {\r\n    let dx = Math.abs(x1 - x2)\r\n    let dy = Math.abs(y1 - y2)\r\n    return dx - dy;\r\n}\r\n\r\nexport const distance = manhattan;\r\n// (x1: number, x2: number, y1: number, y2: number): number => {\r\n// }\r\n","export function flip<T>(a: T, b: T, weight: number = 0.5): T { return Math.random() < weight ? a : b; }\r\n","const indexSpaces: { [key: number]: number[] } = {}\r\nexport const iota = (i: number) => {\r\n    if (!indexSpaces[i]) {\r\n        let nums = [];\r\n        for (let j = 0; j <= i; j++) {\r\n            nums.push(j);\r\n        }\r\n        indexSpaces[i] = nums;\r\n    }\r\n    return indexSpaces[i];\r\n};\r\n","export function pick<T>(...list: T[]): T {\r\n    let idx = Math.floor(Math.random() * list.length);\r\n    return list[idx];\r\n}","export function count(list: boolean[], property: (t: boolean) => boolean) {\r\n    return list.reduce((acc, curr) => property(curr) ? ++acc : acc, 0);\r\n}","import { Location } from '../types/Location';\r\nimport { count } from '../util/count';\r\n\r\nexport type ConwayConfig = {\r\n    active: boolean,\r\n    neighbors: boolean[],\r\n    birth: number,\r\n    lonely: number,\r\n    starve: number,\r\n}\r\nexport type Conway = 'birth' | 'death' | 'unchanged'\r\n\r\nexport type ConwayCallback = (value: boolean, neighbors: boolean[], location: Location) => Conway | undefined;\r\n\r\nfunction conway({ active, neighbors, birth, lonely, starve }: ConwayConfig): Conway {\r\n    let ns = count(neighbors, Boolean)\r\n    if (active) {\r\n        if (ns <= lonely || ns >= starve) {\r\n            return 'death';\r\n        }\r\n    } else {\r\n        if (ns === birth) {\r\n            return 'birth';\r\n        }\r\n    }\r\n    return 'unchanged';\r\n}\r\n\r\nexport function simpleConway(\r\n    birth: number = 3,\r\n    lonely: number = 1,\r\n    starve: number = 4\r\n): ConwayCallback {\r\n    return (cell: boolean, neighbors: boolean[]) => {\r\n        return conway({\r\n            active: cell,\r\n            neighbors,\r\n            birth,\r\n            lonely,\r\n            starve,\r\n        });\r\n    };\r\n}","import { iota } from './iota';\r\n\r\nexport function matrix<T>(\r\n    m: number,\r\n    n: number,\r\n    fn: (location: {x: number, y: number}) => T,\r\n): (T)[][] {\r\n    return iota(m).map(i => iota(n).map((j) => {\r\n        let elem = fn({x: i, y: j});\r\n        return elem;\r\n    }));\r\n}\r\n\r\nexport function matrixWithBackingArray<T>(\r\n    m: number,\r\n    n: number,\r\n    backingArray: T[],\r\n    fn: (x: number, y: number) => T,\r\n): (number)[][] {\r\n    let theMatrix = iota(m).map(i => iota(n).map((j) => {\r\n        let elem = fn(i, j);\r\n        backingArray.push(elem);\r\n        return backingArray.length - 1;\r\n    }));\r\n    console.log(\"constructed matrix\", { theMatrix, zeroth: theMatrix[0][0] })\r\n    return theMatrix;\r\n}\r\n\r\n// export function eachMatrixCoordinate...\r\n\r\nexport function eachMatrixEntry<T>(\r\n    m: T[][],\r\n    fn: (cell: T, i: number, j: number) => any\r\n): void {\r\n    for (let i=0; i<m.length; i++) {\r\n        for (let j=0; j<m[i].length; j++) {\r\n            fn(m[i][j], i, j);\r\n        }\r\n    }\r\n}\r\nexport function eachMatrixCoordinate<T>(\r\n    m: number,\r\n    n: number,\r\n    // m: T[][],\r\n    fn: (i: number, j: number) => any\r\n): void {\r\n    for (let i=0; i<m; i++) {\r\n        for (let j=0; j<n; j++) {\r\n            fn(i, j);\r\n        }\r\n    }\r\n}\r\n","import { distance } from '../util/distance';\r\nimport { Location } from '../types/Location';\r\nimport { Color } from '../types/Palette';\r\nimport { flip } from '../util/flip';\r\nimport { iota } from '../util/iota';\r\nimport { pick } from '../util/pick';\r\nimport BitArray from 'bit-array';\r\nimport { Conway, ConwayCallback, simpleConway } from './Conway';\r\nimport { eachMatrixCoordinate } from '../util/matrix';\r\n\r\ninterface GridConfig {\r\n    initFn: (location: Location) => boolean\r\n    color?: Color\r\n    translucent?: boolean\r\n    visible?: boolean\r\n}\r\n\r\nclass GridStructure {\r\n    private elements: BitArray // 224ms get on 62s profile\r\n    constructor(private m: number, private n: number) {\r\n        this.elements = new BitArray(m*n) //(m-1)*(n-1))\r\n    }\r\n\r\n    setAll(elems: boolean[]) {\r\n        // this.elements = elems;\r\n        this.elements.reset()\r\n        elems.forEach((elem, idx) => this.elements.set(idx, elem))\r\n    }\r\n\r\n    at(x: number, y: number): boolean {\r\n        // return this.elements[this.addr(x,y)]\r\n        return this.elements.get(this.addr(x,y));\r\n    }\r\n\r\n    set(x: number, y: number, value: boolean): void {\r\n        // this.elements[this.addr(x,y)] = value;\r\n        this.elements.set(this.addr(x,y), value);\r\n    }\r\n\r\n    flip(x: number, y: number) {\r\n        // this.set(x,y,!this.at(x,y))\r\n        this.elements.toggle(this.addr(x,y))\r\n    }\r\n\r\n    addr(x: number, y: number) {\r\n        return y * (this.m) + x;\r\n    }\r\n}\r\n\r\nexport default class Grid {\r\n    static assemble(\r\n        dims: { x: number, y: number },\r\n        color: Color,\r\n        initFn: (location: Location) => boolean = () => flip(true, false),\r\n        translucent: boolean = false,\r\n        visible: boolean = true,\r\n        // scale: number = 64\r\n    ) {\r\n        // console.log(\"assemble grid\", { dims, color })\r\n        let g = new Grid(\r\n            dims.x,\r\n            dims.y,\r\n            { initFn, color, translucent, visible }\r\n        )\r\n        // g.scale(scale)\r\n        return g\r\n    }\r\n\r\n    private structure: GridStructure\r\n    \r\n    constructor(\r\n        public m: number,\r\n        public n: number,\r\n        public config: GridConfig = {\r\n            initFn: () => flip(true, false),\r\n            color: 'red',\r\n            translucent: true,\r\n        }\r\n    ) {\r\n        this.structure = new GridStructure(m,n);\r\n        iota(m).forEach(i => iota(n).forEach((j) => {\r\n            let loc={x:i,y:j}\r\n            this.put(loc, config.initFn(loc))\r\n        }));\r\n    }\r\n\r\n    withinBounds(x: number, y: number): boolean {\r\n        let x0 = 0, y0 = 0, x1 = this.m-1, y1 = this.n-1\r\n        return x >= x0 && y >= y0 && x <= x1 && y <= y1\r\n    }\r\n\r\n    at(location: Location): boolean | undefined {\r\n        let { x, y } = location;\r\n        if (this.withinBounds(x,y)) {\r\n            return this.structure.at(x,y)\r\n        }\r\n    }\r\n\r\n    put(location: Location, value: boolean) {\r\n        let { x, y } = location;\r\n        if (this.withinBounds(x, y)) {\r\n            this.structure.set(x, y, value)\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    activate(location: Location) {\r\n        this.put(location, true)\r\n    }\r\n\r\n    deactivate(location: Location) {\r\n        this.put(location, false)\r\n    }\r\n\r\n    scale(z: number=2) {\r\n        console.log(\"SCALE\", {z })\r\n        let newStructure: GridStructure = new GridStructure(this.m, this.n)\r\n        // let newElements: boolean[] = [];\r\n        eachMatrixCoordinate(this.m, this.n, (x: number, y: number) => {\r\n            let x0 = Math.floor(x / z)\r\n            let y0 = Math.floor(y / z)\r\n            let c = this.at({ x: x0, y: y0 })\r\n            if (c !== undefined) {\r\n                newStructure.set(x,y,c)\r\n                // newElements.push(c)\r\n            }\r\n        })\r\n        this.structure = newStructure; //.setAll(newElements);\r\n        return this;\r\n    }\r\n\r\n    shift(dx: number = 0, dy: number = 0, empty: () => boolean = () => flip(true, false)) {\r\n        let newStructure: GridStructure = new GridStructure(this.m, this.n)\r\n        eachMatrixCoordinate(this.m, this.n, (x: number, y: number) => {\r\n            if (this.withinBounds(x + dx, y + dy)) {\r\n                let cell = this.at({\r\n                    x: x + dx,\r\n                    y: y + dy\r\n                })\r\n                if (cell !== undefined) {\r\n                    newStructure.set(x, y, cell)\r\n                }\r\n            } else {\r\n                newStructure.set(x,y,empty())\r\n            }\r\n        })\r\n        this.structure = newStructure;\r\n        return this;\r\n    }\r\n\r\n    static neighborsMap: Location[][][] = []\r\n    static neighbors(location: Location): Location[] {\r\n        let { x, y } = location;\r\n        if (Grid.neighborsMap[x] && Grid.neighborsMap[x][y]) {\r\n            return Grid.neighborsMap[x][y]\r\n        } else {\r\n            let i = x, j = y;\r\n            let list = [\r\n                { x: i - 1, y: j },\r\n                { x: i,     y: j - 1 },\r\n                { x: i,     y: j + 1 },\r\n                { x: i + 1, y: j },\r\n                { x: i - 1, y: j - 1 },\r\n                { x: i - 1, y: j + 1 },\r\n                { x: i + 1, y: j - 1 },\r\n                { x: i + 1, y: j + 1 },\r\n            ];\r\n            Grid.neighborsMap[x] = Grid.neighborsMap[x] || [];\r\n            Grid.neighborsMap[x][y] = list;\r\n            return list;\r\n        }\r\n    }\r\n\r\n    static communityMap: Location[][][][] = []\r\n    static community(location: Location, radius: number): Location[] {\r\n        let {x,y} = location;\r\n        let r = radius;\r\n        if (r === 1) { return Grid.neighbors(location) }\r\n        // if (Grid.communityMap[r] && Grid.communityMap[r][x] && Grid.communityMap[r][x][y]) {\r\n        if (Grid.communityMap[x] && Grid.communityMap[x][y] && Grid.communityMap[x][y][r]) {\r\n            return Grid.communityMap[x][y][r];\r\n        } else {\r\n            let r = radius;\r\n            let list: Location[] = []\r\n            for (let i = x - r; i < x + r + 1; i++) {\r\n                for (let j = y - r; j < y + r + 1; j++) {\r\n                    // let n = this.at({ x: i, y: j });\r\n                    if (distance(i, x, j, y) <= r) {\r\n                        let loc: Location = {x,y}\r\n                        list.push(loc) //{x,y})\r\n                    }\r\n                }\r\n            }\r\n\r\n            Grid.communityMap[x] = Grid.communityMap[x] || [];\r\n            Grid.communityMap[x][y] = Grid.communityMap[x][y] || [];\r\n            Grid.communityMap[x][y][r] = list;\r\n\r\n            return list;\r\n        }\r\n    }\r\n\r\n\r\n    gatherNeighbors(location: Location, radius: number = 1): boolean[] {\r\n        if (radius < 1) { throw new Error(\"Neighborhoods must have a radius > 1\")}\r\n        let neighbors: Location[] = []\r\n        if (radius === 1) {\r\n            neighbors = Grid.neighbors(location)\r\n        } else {\r\n            neighbors = Grid.community(location, radius)\r\n        }\r\n        let neighborCells: boolean[] = [];\r\n        for (let loc of neighbors) {\r\n            let val = this.at(loc)\r\n            if (val !== undefined) {\r\n                neighborCells.push(val)\r\n            }\r\n        }\r\n        return neighborCells;\r\n    }\r\n\r\n    judgeCell(radius: number = 1, location: Location, cell: boolean, cb: ConwayCallback, books: { life: Location[], death: Location[] }) {\r\n        let neighbors: boolean[] = this.gatherNeighbors(location, radius)\r\n        let judgment: Conway | undefined = cb(cell, neighbors, location)\r\n\r\n        if (judgment) {\r\n            if (judgment === 'death') {\r\n                books.death.push(location)\r\n            } else if (judgment === 'birth') {\r\n                books.life.push(location)\r\n            }\r\n        }\r\n    }\r\n\r\n    gol(cellCallback: ConwayCallback = simpleConway(), radius: number = 1) {\r\n        let books: { life: Location[], death: Location[] } = { life: [], death: [] }\r\n        for (let i = 0; i < this.m; i++) {\r\n            for (let j = 0; j < this.n; j++) {\r\n                let x = i, y = j;\r\n                let cell = this.at({x,y})\r\n                if (cell !== undefined) {\r\n                    this.judgeCell(radius, { x, y }, cell, cellCallback, books)\r\n                }\r\n            }\r\n        }\r\n        books.life.forEach((location: Location) => {\r\n            this.activate(location)\r\n        })\r\n        books.death.forEach((location: Location) => {\r\n            this.deactivate(location)\r\n        })\r\n    }\r\n\r\n\r\n    noise(fz=0.1) {\r\n         for (let i = 0; i < this.m; i++) {\r\n            for (let j = 0; j < this.n; j++) {\r\n                if (Math.random() < fz) {\r\n                    let x = i, y = j;\r\n                    let cell = this.at({ x, y })\r\n                    if (cell !== undefined) {\r\n                        this.structure.flip(x,y) //.put({x,y}, flip(true, false))\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    smooth(radius: number = pick(1, 2), eps = 0.25) {\r\n        this.gol((cell, community, _location) => {\r\n            // let community = this.gatherNeighbors(location, radius) //pick(2,3,4))\r\n            let cs = community.reduce((acc, curr) => curr ? ++acc : acc, 0)\r\n            let ratio = cs / community.length\r\n            let base = 0.5 //, eps = 0.24\r\n            if (!cell) {\r\n                if (ratio > base + eps) {\r\n                    return 'birth'\r\n                }\r\n            } else if (cell) {\r\n                if (ratio < base - eps) {\r\n                    return 'death'\r\n                }\r\n            }\r\n        }, radius)\r\n    }\r\n}","import { WorldSize } from \"./WorldSize\";\r\nimport { flip } from \"../../util/flip\";\r\nimport { pick } from \"../../util/pick\";\r\nexport type WorldConfig = {\r\n    size: WorldSize;\r\n    tickSeries: number[];\r\n    waterRatio: number;\r\n    cloudRatio: number;\r\n};\r\nexport const defaultConfig: WorldConfig = {\r\n    size: 'small',\r\n    waterRatio: 0.5,\r\n    cloudRatio: 0.38,\r\n    tickSeries: [1,1,2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31].map(t => t**2)\r\n}\r\n","const unit = 64;\r\nexport const dimensions = {\r\n    tiny:     { x: unit*2, y: unit*1 },\r\n    small:    { x: unit*4, y: unit*3 },\r\n    medium:   { x: unit*5, y: unit*4 },\r\n    large:    { x: unit*8, y: unit*6 },\r\n    huge:     { x: unit*12, y: unit*8 },\r\n    gigantic: { x: unit*16, y: unit*10 },\r\n    enormous: { x: unit*21, y: unit*9 },\r\n}\r\nexport type WorldSize = keyof typeof dimensions;\r\n","import { StackLayers } from \"../Stack\";\r\nimport { flip } from \"../../util/flip\";\r\nimport { pick } from \"../../util/pick\";\r\nimport { count } from \"../../util/count\";\r\nimport { Location } from '../../types/Location';\r\nimport { iota } from \"../../util/iota\";\r\nimport { pathToFileURL } from \"url\";\r\nimport Grid from \"../Grid\";\r\n\r\nexport type Evolution = (layers: StackLayers) => void\r\n\r\nexport class PlanetaryEvolution {\r\n    static windPushesClouds = (dx: number, dy: number) => (layers: StackLayers) => {\r\n        layers.clouds.shift(dx, dy, () => flip(true, false, 0.4));\r\n    }\r\n\r\n\r\n    static cloudsGather(layers: StackLayers): void {\r\n        let { clouds } = layers;\r\n        clouds.smooth(pick(1, 2, 4), 0.212)\r\n    }\r\n\r\n    static oceanLevelsRise(layers: StackLayers): void {\r\n        let { water } = layers;\r\n        let radius = pick(...iota(4).map(r => r + 1))\r\n        let epsilon = 0.1185\r\n        water.smooth(radius, epsilon)\r\n    }\r\n\r\n    static cloudsForm(layers: StackLayers): void {\r\n        let { clouds, water } = layers;\r\n        // clouds.smooth()\r\n        clouds.gol((cell, ns, loc) => {\r\n            let neighbors = count(ns, Boolean);\r\n            if (cell) {\r\n                // if (neighbors < 1) { return 'death' }\r\n            } else {\r\n                if (neighbors > 6) { return 'birth' }\r\n                if (neighbors > 5 && water.at(loc)) {\r\n                    //     // if (Math.random() < 0.05) {\r\n                    return 'birth'\r\n                    //     // }\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    static treesGrow(layers: StackLayers): void {\r\n        let { grass, clouds, water, trees } = layers;\r\n        trees.gol((cell, ns, location) => {\r\n            let neighbors = count(ns, Boolean)\r\n            let ocean = count(water.gatherNeighbors(location), Boolean)\r\n            let veg = count(grass.gatherNeighbors(location), Boolean) + neighbors\r\n            if (cell) {\r\n                if (ocean > 1) {\r\n                    return 'death'\r\n                }\r\n                // if (Math.random() < 0.02) {\r\n                //     return 'death'\r\n                // }\r\n            } else {\r\n                if (ocean == 0) {\r\n                    let chance = Math.random() < 0.1\r\n                    if (chance) {\r\n                        if (neighbors >= 1 && veg > 5) { //} && Math.random() < 0.2) { //} && Math.random() < 0.02) {\r\n                            return 'birth'\r\n                        } else {\r\n                            if (veg > 7 && Math.random() < 0.1) {\r\n                                return 'birth'\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    static grassGrows(layers: StackLayers): void {\r\n        let { grass, clouds, water } = layers\r\n        grass.gol((cell, ns, location) => {\r\n            let neighbors = count(ns, Boolean)\r\n            let sky = clouds.at(location)\r\n            let ocean = water.at(location)\r\n            let waterNeighbors: number = count(water.gatherNeighbors(location), Boolean) // n => !!n)\r\n            if (cell) {\r\n                if (ocean) { return 'death'; }\r\n            } else {\r\n                if (!ocean) {\r\n                    let chance = true // Math.random() < 0.35\r\n                    if (chance) {\r\n                        if (waterNeighbors > 1 && sky) {\r\n                            clouds.deactivate(location)\r\n                            return 'birth';\r\n                        }\r\n                        if (waterNeighbors > 0 && neighbors > 0) {\r\n                            return 'birth';\r\n                        }\r\n                        if (neighbors > 2) {\r\n                            return 'birth'\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    static trailsDecay(layers: StackLayers): void {\r\n        let { trail, path } = layers;\r\n        trail.gol((cell, ns, loc) => {\r\n            if (cell) {\r\n                if (Math.random() < 0.02) {\r\n                    return 'death';\r\n                }\r\n            }\r\n        })\r\n        path.gol((cell, ns, loc) => {\r\n            if (cell) {\r\n                if (Math.random() < 0.002) {\r\n                    return 'death';\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    static animalsWander(layers: StackLayers): void {\r\n        let { animals, water, trees, grass, trail, path } = layers;\r\n        let movers: Location[] = []\r\n        animals.gol((cell, ns, loc) => {\r\n            if (cell) {\r\n                let ocean = water.at(loc)\r\n                if (ocean) {\r\n                    // console.log(\"swimming!\", { loc })\r\n                    return 'death'\r\n                }\r\n                else {\r\n                    if (Math.random() < 0.8) {\r\n                        movers.push(loc)\r\n                    }\r\n                }\r\n            }\r\n        })\r\n        movers.forEach(location => {\r\n            let stepCandidates: Location[] = Grid.neighbors(location)\r\n            stepCandidates = stepCandidates.filter(s =>\r\n                animals.withinBounds(s.x, s.y) && !water.at(s) && !animals.at(s)\r\n            )\r\n            stepCandidates = stepCandidates.sort(() => Math.random() > 0.5 ? -1 : 1)\r\n            let step = stepCandidates.find(s => trees.at(s)) ||\r\n                stepCandidates.find(s => path.at(s)) ||\r\n                stepCandidates.find(s => trail.at(s))\r\n            if (!step || Math.random() < 0.2) {\r\n                step = pick(...stepCandidates)\r\n            }\r\n            if (step) {\r\n                animals.deactivate(location);\r\n                animals.activate(step);\r\n                if (trees.at(step)) {\r\n                    trees.deactivate(step)\r\n                }\r\n                if (!path.at(location)) {\r\n                    if (trail.at(location)) {\r\n                        if (Math.random() < 0.05) {\r\n                            if (count(path.gatherNeighbors(location), Boolean) < 3) {\r\n                                path.activate(location)\r\n                            }\r\n                        }\r\n                    } else {\r\n                        if (Math.random() < 0.7) {\r\n                            if (count(trail.gatherNeighbors(location), Boolean) < 4) {\r\n                                trail.activate(location)\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        })\r\n    }\r\n}\r\n","import Stack from \"../Stack\";\r\nimport Grid from \"../Grid\";\r\nimport { WorldConfig, defaultConfig } from \"./WorldConfig\";\r\nimport { dimensions } from \"./WorldSize\";\r\nimport { flip } from \"../../util/flip\";\r\nimport { iota } from \"../../util/iota\";\r\nimport { PlanetaryEvolution, Evolution } from \"./Evolution\";\r\nimport { Location } from '../../types/Location';\r\n\r\ntype Dimensions = { x: number, y: number }\r\n\r\nclass Person {\r\n    constructor(private location: Location) {}\r\n}\r\n\r\nexport class World {\r\n    private player: Person = new Person({x:10,y:10})\r\n    private stack: Stack;\r\n    private dims: Dimensions\r\n    private ticks = 0;\r\n\r\n    private evolutionarySeries: Evolution[] = [\r\n        PlanetaryEvolution.animalsWander,\r\n        PlanetaryEvolution.cloudsGather,\r\n        PlanetaryEvolution.windPushesClouds(-1,-1),\r\n        PlanetaryEvolution.treesGrow,\r\n        PlanetaryEvolution.cloudsForm,\r\n        PlanetaryEvolution.grassGrows,\r\n        PlanetaryEvolution.trailsDecay,\r\n        // PlanetaryEvolution.oceanLevelsRise,\r\n    ]\r\n\r\n    constructor(private config: WorldConfig = defaultConfig) {\r\n        this.dims = dimensions[config.size]\r\n        console.log(\"Assembling world layers...\")\r\n        this.stack = new Stack({\r\n            water: Grid.assemble(this.dims, 'blue', () => flip(true, false, config.waterRatio)),\r\n            grass: Grid.assemble(this.dims, 'green', () => false),\r\n            trees: Grid.assemble(this.dims, 'dark-green', () => false),\r\n            // attach names?\r\n            trail: Grid.assemble(this.dims, 'pink', () => false, true, false),\r\n            path: Grid.assemble(this.dims, 'light-brown', () => false, false, false),\r\n            animals: Grid.assemble(this.dims, 'white', () => flip(true, false, 0.01), false, true),\r\n            humans: Grid.assemble(this.dims, 'white', () => false, false, true),\r\n            clouds: Grid.assemble(this.dims, 'white', () => flip(true, false, config.cloudRatio), true),\r\n        })\r\n        console.log(\"World layers assembled!\")\r\n        // this.prepareLandscape();\r\n    }\r\n\r\n    private prepareLandscape() {\r\n        let q=1, z = 1.3\r\n        let n = 5 //0.07 * 10 ** 2\r\n        for (let j of iota(q)) {\r\n            for (let i of iota(n)) {\r\n                PlanetaryEvolution.oceanLevelsRise(this.stack.layers)\r\n                // this.evolve();\r\n                console.log(\"startup evolution I\", (i / n) * 100, j)\r\n            }\r\n            this.stack.layers.water.scale(z) ///q) //1.04) //z/q) //1.675)\r\n            for (let i of iota(n)) {\r\n                // this.evolve();\r\n                PlanetaryEvolution.oceanLevelsRise(this.stack.layers)\r\n                console.log(\"startup evolution II\", (i / n) * 100, j)\r\n            }\r\n        }\r\n    }\r\n\r\n    get layers() { return this.stack.layers; }\r\n\r\n    evolve(): boolean {\r\n        let evolved = false;\r\n        this.ticks += 1;\r\n        if (this.ticks < 9) {\r\n            if (this.ticks > 5) {\r\n                this.prepareLandscape();\r\n            }\r\n            return true;\r\n        } else {\r\n            this.evolutionarySeries.forEach((evolution: Evolution, index: number) => {\r\n                let interval = this.config.tickSeries[index];\r\n                if (this.ticks % interval === 0) {\r\n                    if (evolution) {\r\n                        evolution.call(this, this.layers);\r\n                        evolved = true;\r\n                    }\r\n                }\r\n            })\r\n            return evolved;\r\n        }\r\n    }\r\n}","// import React from 'react';\n// import ReactDOM from 'react-dom';\n// import './index.css';\n// import App from './App';\n// import * as serviceWorker from './serviceWorker';\nimport { Game } from './Game';\nimport { World } from './models/World';\n\n// ReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.unregister();\n\nlet world: World = new World()\nlet game: Game = new Game(world)\n// game.backgroundColor = Color.Black.clone().lighten(0.02)\n\n// game.add(cells)\n\ngame.start()\n"],"sourceRoot":""}